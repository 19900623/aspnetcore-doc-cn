<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <!--配置参数-->
    <WorkDir>C:\projects\aspnetcore-doc-cn\</WorkDir>
    <webDir>C:\website\aspnetcore-doc-cn\</webDir>
    <webName>dotnetcore.github.io</webName>
    <domainName>aspnet.docs.dotnet-china.org</domainName>
    <baiduCode>Bh1NXh3smd</baiduCode>
    <webrepUrl>https://github.com/dotnetcore/dotnetcore.github.io</webrepUrl>
    <docfxPath>"$(WorkDir)aspnetcore\docfx.json"</docfxPath>    
    <templatePath>"$(WorkDir)_exported_templates\default"</templatePath>
    <sitePath>"$(WorkDir)aspnetcore\_site"</sitePath>
    <sourcePath>$(WorkDir)aspnetcore</sourcePath>
    <pubsitePath>"$(webDir)$(webName)"</pubsitePath> 
    <pdfresourcePath>"$(WorkDir)\pdfresource"</pdfresourcePath>
    <SubDirName>aspnetcoredoccn</SubDirName>   
    <ProjectDir>$(webDir)$(webName)\$(SubDirName)\</ProjectDir>  
  </PropertyGroup>


 
   <Target Name="build">
 
  <CallTarget Targets="buildwebsite"/> 
  <CallTarget Targets="buildPdf"/>
  <CallTarget Targets="pubish2githubIo"/> 
 
  
  </Target>


  <!--生成网站-->
  <Target Name="buildwebsite">
 
    <Message Text="Start to build website"></Message>
 
    <Exec Command="docfx build $(docfxPath) -t $(templatePath) "  WorkingDirectory="$(WorkDir)"   ></Exec> 

    <Message Text="Build website successfully."></Message>

    <Message Text="Start to fix website files"></Message>
 
    <Exec Command="FixSite.exe $(sitePath) "></Exec>

    <Message Text="Fix website files"></Message>

  </Target>


<!--发布网站到githubio-->
  <Target Name="pubish2githubIo">
 
    <Exec Command="git clone --progress $(webrepUrl) "  WorkingDirectory="$(webDir)" />

    <!-- <Exec Command="git rm * -r"  WorkingDirectory="$(webDir)$(webName)"   ></Exec> -->

    <RemoveDir Directories="$(ProjectDir)" />  
 
    <MakeDir  Directories="$(ProjectDir)"/>  

    <Delete Files="$(ProjectDir)" />  

    <Exec Command="xcopy.exe  $(sitePath) $(ProjectDir) /e" />
    
    <!-- <Exec Command="echo $(domainName) > CNAME"  WorkingDirectory="$(webDir)$(webName)"   ></Exec>

    <Exec Command="echo $(baiduCode) > baidu_verify_Bh1NXh3smd.html"  WorkingDirectory="$(webDir)$(webName)"   ></Exec> -->
    

    <Exec Command="git add -A"  WorkingDirectory="$(webDir)$(webName)"   ></Exec>

    <Exec Command="git commit -m &quot;submit new website&quot;"  WorkingDirectory="$(webDir)$(webName)"   ></Exec>

    <Exec Command="git push --progress -u origin master "  WorkingDirectory="$(webDir)$(webName)"   ></Exec>
 
  </Target>


    <Target Name="buildPdf">

    <Exec Command="xcopy.exe $(pdfresourcePath) $(sourcePath) /e /s" />

    <Exec Command="docfx.exe pdf docfxpdf.json"  WorkingDirectory="$(sourcePath)" />

    <Exec Command="move $(sourcePath)\_site-pdf\aspnetcore.pdf $(sourcePath)\_site\aspnet_core_doc_cn.pdf"/>

  </Target>

 
 

</Project>